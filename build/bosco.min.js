var bosco;
(function(bosco){var Properties=function(){function Properties(){}Properties.init=function(name,properties){if(Properties.db!==null)return;function initializeDb(db){if(db.isNew()){db.createTable("settings",["name","value"]);db.createTable("leaderboard",["date","score"]);for(var key in properties)if(properties.hasOwnProperty(key))db.insert("settings",{name:key,value:properties[key]});db.commit()}}Properties.dbname=name;Properties.properties=properties;if(window["chrome"])chromeStorageDB(Properties.dbname,localStorage,
function(db){return initializeDb(Properties.db=db)});else initializeDb(Properties.db=new localStorageDB(Properties.dbname))};Properties.get=function(prop){return Properties.db.queryAll("settings",{query:{name:prop}})[0].value};Properties.setScore=function(score){var today=new Date;var mm=(today.getMonth()+1).toString();if(mm.length===1)mm="0"+mm;var dd=today.getDate().toString();if(dd.length===1)dd="0"+dd;var yyyy=today.getFullYear().toString();var yyyymmdd=yyyy+mm+dd;if(0===Properties.db.queryAll("leaderboard",
{query:{date:yyyymmdd}}).length)Properties.db.insert("leaderboard",{date:yyyymmdd,score:score});else Properties.db.update("leaderboard",{date:yyyymmdd},function(row){if(score>row.score)row.score=score;return row});Properties.db.commit()};Properties.getLeaderboard=function(count){return Properties.db.queryAll("leaderboard",{limit:count,sort:[["score","DESC"]]})};Properties.db=null;Properties.dbname="";Properties.properties=null;Properties.set=function(prop,value){Properties.db.update("settings",{name:prop},
function(row){row.value=""+value;return row});Properties.db.commit()};return Properties}();bosco.Properties=Properties})(bosco||(bosco={}));var bosco;
(function(bosco){var utils;(function(utils){var Input=function(){function Input(){var _this=this;this.states={};this.mouseDown=false;this.mouseButtonDown=false;this.mousePosition={x:0,y:0};this.isDown=function(keyCode){return _this.states[keyCode]};this.isUp=function(keyCode){return!_this.states[keyCode]};this.onKeyUp=function(event){if(_this.states[event.keyCode])_this.states[event.keyCode]=false};this.onKeyDown=function(event){_this.states[event.keyCode]=true};this.onTouchStart=function(event){event=
event.targetTouches?event.targetTouches[0]:event;if(_this.isFullScreen===undefined)_this.checkFullScreen();_this.mouseDown=true;_this.mouseButtonDown=true;_this.mousePosition.x=parseInt(event.clientX);_this.mousePosition.y=parseInt(event.clientY);return true};this.onTouchMove=function(event){event=event.targetTouches?event.targetTouches[0]:event;_this.mousePosition.x=parseInt(event.clientX);_this.mousePosition.y=parseInt(event.clientY)};this.onTouchEnd=function(event){_this.mouseDown=false;_this.mouseButtonDown=
false};document.addEventListener("touchstart",this.onTouchStart,true);document.addEventListener("touchmove",this.onTouchMove,true);document.addEventListener("touchend",this.onTouchEnd,true);document.addEventListener("mousedown",this.onTouchStart,true);document.addEventListener("mousemove",this.onTouchMove,true);document.addEventListener("mouseup",this.onTouchEnd,true);window.addEventListener("keydown",this.onKeyDown,true);window.addEventListener("keyup",this.onKeyUp,true)}Object.defineProperty(Input,
"mousePosition",{get:function(){return Input._input.mousePosition},enumerable:true,configurable:true});Input.getKeyDown=function(k){return Input._input.isDown(k.charCodeAt(0))};Input.getKeyUp=function(k){return Input._input.isUp(k.charCodeAt(0))};Input.getMouseButtonUp=function(m){return!Input._input.mouseButtonDown};Input.getMouseButton=function(m){return Input._input.mouseDown};Input.getMouseButtonDown=function(m){return Input._input.mouseButtonDown};Input.update=function(){Input._input.mouseDown=
false;Input._input.states={}};Input.prototype.checkFullScreen=function(){if(this.isFullScreen===undefined)if(bosco.config.fullScreen===undefined)this.isFullScreen=false;else this.isFullScreen=bosco.isMobile()||bosco.config.fullScreen;if(this.isFullScreen)try{if(document.documentElement["requestFullscreen"])document.documentElement["requestFullscreen"]();else if(document.documentElement["mozRequestFullScreen"])document.documentElement["mozRequestFullScreen"]();else if(document.documentElement["webkitRequestFullscreen"])document.documentElement["webkitRequestFullscreen"]();
else if(document.documentElement["msRequestFullscreen"])document.documentElement["msRequestFullscreen"]()}catch(e){}};Input._input=new Input;return Input}();utils.Input=Input})(utils=bosco.utils||(bosco.utils={}))})(bosco||(bosco={}));var bosco;
(function(bosco){var utils;(function(utils){var Rnd=function(){function Rnd(){}Rnd.nextBool=function(){return(~~(Math.random()*32767)&1)===1};Rnd.nextDouble=function(){return Math.random()};Rnd.nextInt=function(max){return~~(Math.random()*max)};Rnd.random=function(start,end){if(end===undefined)return Rnd.nextInt(start+1);else if(parseInt(start)===parseFloat(start)&&parseInt(end)===parseFloat(end))return start+Rnd.nextInt(end-start+1);else return start+Rnd.nextDouble()*(end-start)};return Rnd}();utils.Rnd=
Rnd})(utils=bosco.utils||(bosco.utils={}))})(bosco||(bosco={}));var bosco;
(function(bosco){var utils;(function(utils){var Timer=function(){function Timer(delay,repeat){if(repeat===void 0)repeat=false;this.execute=function(){};this.delay=delay;this.repeat=repeat;this.acc=0}Timer.prototype.update=function(delta){if(!this.done&&!this.stopped){this.acc+=delta;if(this.acc>=this.delay){this.acc-=this.delay;if(this.repeat)this.reset();else this.done=true;this.execute()}}};Timer.prototype.reset=function(){this.stopped=false;this.done=false;this.acc=0};Timer.prototype.isDone=function(){return this.done};
Timer.prototype.isRunning=function(){return!this.done&&this.acc<this.delay&&!this.stopped};Timer.prototype.stop=function(){this.stopped=true};Timer.prototype.setDelay=function(delay){this.delay=delay};Timer.prototype.getPercentageRemaining=function(){if(this.done)return 100;else if(this.stopped)return 0;else return 1-(this.delay-this.acc)/this.delay};Timer.prototype.getDelay=function(){return this.delay};return Timer}();utils.Timer=Timer})(utils=bosco.utils||(bosco.utils={}))})(bosco||(bosco={}));
var bosco;
(function(bosco){var utils;(function(utils){var TrigLUT=function(){function TrigLUT(){}TrigLUT.sin=function(rad){return TrigLUT.sin_[rad*TrigLUT.radToIndex&TrigLUT.SIN_MASK]};TrigLUT.cos=function(rad){return TrigLUT.cos_[rad*TrigLUT.radToIndex&TrigLUT.SIN_MASK]};TrigLUT.sinDeg=function(deg){return TrigLUT.sin_[deg*TrigLUT.degToIndex&TrigLUT.SIN_MASK]};TrigLUT.cosDeg=function(deg){return TrigLUT.cos_[deg*TrigLUT.degToIndex&TrigLUT.SIN_MASK]};TrigLUT.init=function(update){TrigLUT.RAD=Math.PI/180;TrigLUT.DEG=
180/Math.PI;TrigLUT.SIN_BITS=12;TrigLUT.SIN_MASK=~(-1<<TrigLUT.SIN_BITS);TrigLUT.SIN_COUNT=TrigLUT.SIN_MASK+1;TrigLUT.radFull=Math.PI*2;TrigLUT.degFull=360;TrigLUT.radToIndex=TrigLUT.SIN_COUNT/TrigLUT.radFull;TrigLUT.degToIndex=TrigLUT.SIN_COUNT/TrigLUT.degFull;TrigLUT.sin_=new Array(TrigLUT.SIN_COUNT);TrigLUT.cos_=new Array(TrigLUT.SIN_COUNT);for(var i=0;i<TrigLUT.SIN_COUNT;i++){TrigLUT.sin_[i]=Math.sin((i+.5)/TrigLUT.SIN_COUNT*TrigLUT.radFull);TrigLUT.cos_[i]=Math.cos((i+.5)/TrigLUT.SIN_COUNT*TrigLUT.radFull)}if(update){Math.sin=
TrigLUT.sin;Math.cos=TrigLUT.cos}};return TrigLUT}();utils.TrigLUT=TrigLUT})(utils=bosco.utils||(bosco.utils={}))})(bosco||(bosco={}));var bosco;(function(bosco){function isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}bosco.isMobile=isMobile})(bosco||(bosco={}));var bosco;
(function(bosco){var Sprite=PIXI.Sprite;var Texture=PIXI.Texture;var Container=PIXI.Container;var Input=bosco.utils.Input;var Properties=bosco.Properties;bosco.fps=0;var _game;function controller(name){if(!bosco.config.controllers[name])return;for(var _i=0,_a=_game.controllers;_i<_a.length;_i++){var controller=_a[_i];controller.stop()}_game.controllers=[];var root=bosco.config.controllers[name];root=Array.isArray(root)?root:[root];for(var _b=0;_b<root.length;_b++){var className=root[_b];var Class=
window[bosco.config.namespace][className];_game.controllers.push(new Class)}for(var _c=0,_d=_game.controllers;_c<_d.length;_c++){var controller=_d[_c];controller.start()}}bosco.controller=controller;function start(config){if(config.properties)Properties.init(config.namespace,config.properties);for(var asset in config.assets)PIXI.loader.add(asset,config.assets[asset]);PIXI.loader.load(function(loader,resources){return new Game(config,resources)})}bosco.start=start;function prefab(name,parent){if(parent===
void 0)parent=bosco.viewContainer;var s=_prefab(bosco.config.resources[name]);if(parent)parent.addChild(s);return s}bosco.prefab=prefab;function _prefab(config){if(Array.isArray(config)){var container=new Sprite;for(var i=0,l=config.length;i<l;i++)container.addChild(_prefab(config[i]));return container}else{var sprite=new Sprite(Texture.fromFrame(config.path));for(var k in config)switch(k){case "anchor":sprite.anchor.set(config.anchor.x,config.anchor.y);break;case "scale":sprite.scale.set(config.scale.x,
config.scale.y);break;case "position":sprite.position.set(config.position.x,config.position.y);break;case "rotation":sprite.rotation=config.rotation;break;case "tint":sprite.tint=config.tint;break}return sprite}}var Game=function(){function Game(config,resources){var _this=this;this.totalFrames=0;this.elapsedTime=0;this.update=function(time){var stats=_this.stats;if(stats)stats.begin();var temp=_this.previousTime||time;_this.previousTime=time;var delta=bosco.delta=(time-temp)*.001;_this.totalFrames++;
_this.elapsedTime+=delta;if(_this.elapsedTime>1){bosco.fps=_this.totalFrames;_this.totalFrames=0;_this.elapsedTime=0}var controllers=_this.controllers;for(var i=0,l=controllers.length;i<l;i++)controllers[i].update(delta);_this.renderer.render(_this.stage);Input.update();requestAnimationFrame(_this.update);if(stats)stats.end()};this.resize=function(){var ratio=Math.min(window.innerWidth/_this.config.width,window.innerHeight/_this.config.height);_this.config.scale=ratio;_this.stage.scale.x=_this.stage.scale.y=
ratio;_this.renderer.resize(Math.ceil(_this.config.width*ratio),Math.ceil(_this.config.height*ratio))};_game=this;this.config=bosco.config=config;this.resources=resources;this.previousTime=0;this.controllers=[];var renderer=this.renderer=PIXI.autoDetectRenderer(config.width,config.height,config.options);renderer.view.style.position="absolute";renderer.view.style.top="0px";renderer.view.style.left="0px";var stage=this.stage=new Container;bosco.viewContainer=this.sprites=new Container;bosco.foreContainer=
this.foreground=new Container;this.resize();document.body.appendChild(renderer.view);if(config.stats){var stats=this.stats=new Stats;stats.setMode(0);stats.domElement.style.position="absolute";stats.domElement.style.left="0px";stats.domElement.style.top="0px";document.body.appendChild(stats.domElement)}window.addEventListener("resize",this.resize,true);window.onorientationchange=this.resize;stage.addChild(this.sprites);stage.addChild(this.foreground);bosco.controller("main");requestAnimationFrame(this.update)}
return Game}();bosco.Game=Game})(bosco||(bosco={}));
